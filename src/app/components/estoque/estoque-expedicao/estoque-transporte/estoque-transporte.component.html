<div class="container">

    <div class="flex-box container-box">

        <br />
        <div class="content-box" *ngIf="showMenu">
            <p-button label="Iniciar Entrega" styleClass="p-button-lg p-button-success" (click)="showIniciaEntrega()">
            </p-button>
            <p-button label="Finalizar Entrega" styleClass="p-button-lg p-button-warning" (click)="showFinalizaEntrega()"></p-button>
        </div>

        <div *ngIf="flipSeparacao">
            <button pButton type="button" (click)="showIniciaEntrega()">Voltar</button>
            <br/>
            <p-card  header="Dados Transporte" >

                <p-toast></p-toast>
                <div *ngIf="isPaginaSubmissao">
                    <form [formGroup]="formTransporte" (ngSubmit)="salvar($event)">
                        <p-card-header>
                            <div class="grid">
                                <div class="col" [hidden]="visualizaMotorista">
                                    <fieldset>
                                        <label>Transportadora</label><br>

                                        <app-transportadora-selector
                                            (eventoCampoTranportadora)="showVisualizaTranportadora()"
                                            (transportadoraSelecionada)="onTransportadoraSelecionada($event)"
                                            pTooltip="Selecione a Transportadora" tooltipPosition="left">
                                        </app-transportadora-selector>
                                    </fieldset>
                                </div>
                                <div class="col" [hidden]="visualizaTranportadora">
                                    <fieldset>
                                        <label>Motorista</label><br>

                                        <app-motorista-selector (eventoCampoMotorista)="showVisualizaMotorista()"
                                            (motoristaSelecionado)="onMotoristaSelecionado($event)"
                                            pTooltip="Selecione o Motorista" tooltipPosition="left">
                                        </app-motorista-selector>
                                    </fieldset>
                                </div>
                                <div class="col" [hidden]="visualizaTranportadora">
                                    <fieldset>
                                        <label>Veiculo</label><br>
                                        <app-veiculo-selector (veiculoSelecionado)="onVeiculoSelecionado($event)"
                                            pTooltip="Selecione o Veiculo" tooltipPosition="left">
                                        </app-veiculo-selector>
                                    </fieldset>
                                </div>
                                <div class="col">
                                    <fieldset>

                                        <label>Obs/Entregador</label><br>
                                        <input pInputText class="p-inputtext-sm" formControlName="obsdoentregador">

                                    </fieldset>
                                </div>
                            </div>
                        </p-card-header>

                        <br />
                        <p-card>
                            <p-table [value]="entregas" [scrollable]="true" scrollHeight="600px" class="table">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Nota</th>
                                        <th style="width: 20rem">Cliente</th>
                                        <th>Vendedor</th>
                                        <th>Volumes</th>
                                        <th style="width: 5rem"></th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-entregas>
                                    <tr>
                                        <td>{{entregas.numnota}}</td>
                                        <td>{{entregas.nomecliente}}</td>
                                        <td>{{entregas.nomevendedor}}</td>
                                        <!--<td>    
                                         {{entregas.numvolume}}  
                                    </td>-->

                                        <td [pEditableColumn]="entregas.numvolume" pEditableColumnField="Volumes">
                                            <div class="divFormEntrega" [formGroup]="formEntrega">
                                                <p-cellEditor>
                                                    <ng-template pTemplate="input">
                                                        <p-inputNumber formControlName="numvolume"
                                                            [(ngModel)]="entregas.numvolume" inputId="minmax"
                                                            mode="decimal" [min]="0" [max]="100"> </p-inputNumber>
                                                    </ng-template>
                                                    <ng-template pTemplate="output">
                                                        {{ entregas.numvolume}}
                                                    </ng-template>
                                                </p-cellEditor>
                                            </div>
                                        </td>

                                        <td>
                                            <button type="button" pButton pRipple icon="pi pi-times"
                                                (click)="removerItem(entregas.numnota)"
                                                class="p-button-warning"></button>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </p-card>
                        <br />
                    </form>

                    <p-card-footer>
                        <div class="grid">
                            <div class="col">
                                <form [formGroup]="form" autocomplete="off" (ngSubmit)="pesquisar()">
                                    <ng-template pTemplate="header">
                                        <span class="text-xl font-bold"></span>
                                    </ng-template>
                                    <div>
                                        <label>Notas Fiscais</label>
                                        <br />
                                        <input #buscaNotaFiscal (keydown.enter)="pesquisar()" type="text"
                                            formControlName="numnota" pInputText>
                                    </div>
                                    <br />
                                    <div>
                                        <button pButton [disabled]="!checkedDisable" (keydown.enter)="pesquisar()"
                                            type="submit" label="Buscar"></button>
                                        &nbsp;
                                        <button pButton [disabled]="!checkedDisable" (click)="limparListaPedidos()"
                                            label="Limpar" class="p-button-warning"></button>
                                    </div>
                                </form>
                            </div>
                            <div class="col">
                                <div class="container-direita">
                                    <button pButton type="button" class="p-button-success" (click)="salvarTransporte()"
                                        label="Iniciar Entrega"></button>
                                </div>
                            </div>
                        </div>
                    </p-card-footer>
                </div>
                <div *ngIf="isShowBuscaEntrega">
                    <form [formGroup]="formFinalizaTransporte" autocomplete="off" (ngSubmit)="pesquisarTransporte()">
                        <ng-template pTemplate="header">
                            <span class="text-xl font-bold"></span>
                        </ng-template>
                        <div>
                            <label>Codigo de Transporte</label>
                            <br />
                            <input (keydown.enter)="pesquisar()" type="text"
                                formControlName="codtransporte" pInputText>
                        </div>
                        <br />
                        <div>
                            <button pButton  (keydown.enter)="pesquisar()"
                                type="submit" label="Buscar"></button>
                            &nbsp;                            
                        </div>
                    </form>
                </div>

                <div *ngIf="isPaginaResumo">
                    <p-card>
                        <form class="form-horizontal">
                        </form>
                        <div id="elemento-para-imprimir">
                            <!-- Conteúdo que você deseja imprimir -->
                            <h2> Romaneio de Entrega:</h2>
                            <br />
                            <div class="grid">
                                <div class="col">
                                    <h3>Cod.Entrega: <br />{{entregaTransporte.id.codentrega}}</h3>
                                </div>
                                <div class="col">
                                    <h3>Cod.Transporte: <br />{{entregaTransporte.id.codtransporte}}</h3>
                                </div>
                                <div class="col">
                                    <h3>Cod.Dt Saida: <br />{{entregaTransporte.dtsaida | date:'dd/MM/y hh:mm:ss'}}</h3>
                                </div>
                            </div>
                            &#013;
                            <div class="grid">
                                <div class="col">
                                    <h3>Cod.Motorista: <br />{{transporte.codmotorista}} - {{entregas[0].nomemotorista}}
                                    </h3>
                                </div>
                                <div class="col">
                                    <h3>Cod.Veiculo: <br />{{transporte.codveiculo}}</h3>
                                </div>
                                <div class="col">
                                    <h3>Cod.Qt Volumes: <br />{{transporte.qtvolumes}}</h3>
                                </div>
                                <div class="col">
                                    <h3>Obs Entrega: <br />{{transporte.obsdoentregador}}</h3>
                                </div>
                            </div>
                            <br />

                            <p-table [value]="entregas" styleClass="p-datatable-striped" class="table">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Nota</th>
                                        <th style="width: 20rem">Cliente</th>
                                        <th>Vendedor</th>
                                        <th>Volumes</th>
                                        <th>Observações</th>
                                        <th>Endereço</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-entregas>
                                    <tr>
                                        <td>{{entregas.numnota}}</td>
                                        <td>{{entregas.nomecliente}}</td>
                                        <td>{{entregas.nomevendedor}}</td>
                                        <td>{{entregas.numvolume}}</td>
                                        <td>{{entregas.obs}} - {{entregas.obs1}}
                                            {{entregas.obsentrega1}} - {{entregas.obsentrega2}} -
                                            {{entregas.obsentrega3}}
                                        </td>
                                        <td>{{entregas.estcob}} - {{entregas.nomecidade}} - {{entregas.endercob}}</td>
                                    </tr>
                                </ng-template>
                             </p-table>
                        </div>
                        <button pButton type="button" (click)="printContent()">Imprimir</button>
                    </p-card>
                </div>

                <div *ngIf="isPaginaFinaliza">
                <div>
                    <p-table [value]="entregaTransporte" selectionMode="single" [(selection)]="entregaTransporteSelecionado" dataKey="code" [tableStyle]="{'min-width': '50rem'}">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Cod Entrega</th>
                                <th>Motivo</th>
                                <th>Dt. Saida</th>
                                <th>Dt. Chegada</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-entregaTransporte>
                            <tr [pSelectableRow]="entregaTransporte">
                                <td>{{entregaTransporte.id.codentrega}}</td>
                                <td>{{entregaTransporte.coddevol}}</td>
                                <td>{{entregaTransporte.dtsaida | date}}</td>
                                <td>{{entregaTransporte.nome}}</td>
                            </tr>
                        </ng-template>
                    </p-table> 
                </div>
                </div>
            </p-card>
        </div>
    </div>
</div>